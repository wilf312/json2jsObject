<!DOCTYPE html>
<html lang="ja">
<head>
<title></title>
<meta charset="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
  body, html {
    margin: 0;
    padding: 0;
  }
  #app {
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: space-around;
    align-items: center;
  }
  .input textarea,
  .output textarea {
    width: 40vw;
    height: 80vh;
  }
</style>
</head>
<body>
<h1>JSON to JS Object</h1>
<div id="app">
  <div class="input">
    <!--キーをソートするか // TODOチェックボックス-->
    <textarea v-model="input"></textarea>
  </div>
  <div class="output">
    <textarea v-text="_output"></textarea>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue" type="text/javascript" charset="UTF-8"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.5/lodash.min.js" type="text/javascript" charset="UTF-8"></script>
<script>
const app = new Vue({
  el: '#app',
  data: {
    input: '{"array": ["aaaa"],"arrayObj": [{"aaaa": 123}],"test": {"a": 1}, "message":"ああああ", "isVisible": true, "count": 777}',
    lineBreak: '\n',
    tabSize: 2 // TODO インデント計算する
  },
  methods: {
    // keyの展開
    json2JSObjectString: function (json) {
      const jsObj = JSON.parse(json)
      this.output = this.parseObject(jsObj)

      return jsObj
    },
    execType: function (key, value) {
      const type = typeof value
      if (type === 'string') {
        return this.getString(key, value)
      } else if (type === 'boolean') {
        return this.getBoolean(key, value)
      } else if (type === 'number') {
        return this.getNumber(key, value)
      } else if (type === 'object') {
        if (Array.isArray(value)) {
          return this.getArray(key, value)
        } else {
          return this.getObject(key, value)
        }
      }
    },
    parseObject: function (obj) {
      let textList = []
      const keys = Object.keys(obj)
      keys.forEach((v) => {
        textList.push(this.execType(v, obj[v]))
      })

      return `{${this.lineBreak}${textList.join(',' + this.lineBreak)}${this.lineBreak}}`
    },
    getString: (key, value) => { return `${key}: "${value}"` },
    getNumber: (key, value) => { return `${key}: ${value}` },
    getBoolean: (key, value) => { return `${key}: ${value ? 'true' : 'false'}` },
    getObject: function (key, value) {
      return `${key}: ${this.parseObject(value)}`
    },
    getStringForArray: (value) => { return `"${value}"` },
    getNumberForArray: (value) => { return `${value}` },
    getBooleanForArray: (value) => { return `${value ? 'true' : 'false'}` },
    getObjectForArray: function (value) {
      return `${this.parseObject(value)}`
    },
    getArray: function (key, value) {
      let val = []
      value.forEach((v) => {
        const type = typeof v
        if (type === 'string') {
          val.push(this.getStringForArray(v))
        } else if (type === 'boolean') {
          val.push(this.getBooleanForArray(v))
        } else if (type === 'number') {
          val.push(this.getNumberForArray(v))
        } else if (type === 'object') {
          if (Array.isArray(v)) {
            val.push(this.getArray(null, v))
          } else {
            val.push(this.getObjectForArray(v))
          }
        }
      })
      return `${key}: [${this.lineBreak}${val.join(',')}${this.lineBreak}]`
    }
  },
  computed: {
    _output: function () {
      this.output = ''
      this.json2JSObjectString(this.input)
      return this.output
    }
  }
})
</script>
</body>
</html>
